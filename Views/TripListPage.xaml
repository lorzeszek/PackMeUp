<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns="http://schemas.microsoft.com/dotnet/maui/global"
             x:DataType="TripListViewModel"
             x:Class="PackMeUp.Views.TripListPage"
             x:Name="TripListView"
             Title="{Binding Title}"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <BoolToOpacityConverter x:Key="BoolToOpacityConverter"
                                               TrueOpacity="1"
                                               FalseOpacity="0.5"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    
    
    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height ="*"/>
            <RowDefinition Height ="Auto"/>
        </Grid.RowDefinitions>
        <CollectionView Grid.Row="0" ItemsSource="{Binding Trips}" SelectionMode="None">
        <CollectionView.ItemsLayout>
            <GridItemsLayout Orientation="Vertical" />
            <!-- 2 kolumny kafelków -->
        </CollectionView.ItemsLayout>

        <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="TripViewModel">
                <Border
                    Margin="10"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 12"
                    HeightRequest="180"
                    Opacity="{Binding TripModel.IsActive, Converter={StaticResource BoolToOpacityConverter}}">

                    <Grid>
                        <!--<Image Source="{Binding BackgroundImageUrl}"-->
                        <Image Source="italy.webp"
                           Aspect="AspectFill"/>
                        
                        <!-- Gradient overlay -->
                        <BoxView 
                            VerticalOptions="End" 
                            HeightRequest="80"
                            Opacity="0.6"
                            Background="{AppThemeBinding Light=Black, Dark=Black}" />

                        <!-- Tekst -->
                            <StackLayout 
                                Padding="10"
                                VerticalOptions="End"
                                Spacing="2">
                                <Label Text="{Binding TripModel.Destination}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="White"
                                       LineBreakMode="TailTruncation" />
                                <Label Text="{Binding TripDatesRange}" 
                               FontSize="13"
                               TextColor="White" />
                                <Label Text="{Binding PackingSummary}"
                               FontSize="12"
                               TextColor="White" />
                            </StackLayout>

                            <LottieView
                                Source="RecycleBin.lottie"
                                HorizontalOptions="End"
                                VerticalOptions="Start"
                                WidthRequest="34"
                                AutoPlay="True"
                                HeightRequest="34">
                                <LottieView.GestureRecognizers>
                                    <TapGestureRecognizer 
                                        Command="{Binding BindingContext.TrashTripCommand, Source={x:Reference TripListView}}" 
                                        CommandParameter="{Binding .}" />
                                </LottieView.GestureRecognizers>
                            </LottieView>

                            <!-- Overlay dla zakończonych -->
                            <BoxView IsVisible="False" BackgroundColor="#88000000" />
                            <!--<BoxView IsVisible="{Binding IsCompleted}" BackgroundColor="#88000000" />-->
                    </Grid>

                    <!-- Tap całości -->
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer 
                            Command="{Binding BindingContext.TripTappedCommand, Source={x:Reference TripListView}}" 
                            CommandParameter="{Binding .}" />
                    </Border.GestureRecognizers>
                </Border>
            </DataTemplate>
        </CollectionView.ItemTemplate>
        
    </CollectionView>
        <Button Grid.Row="1" Margin="0,0,10,0" HorizontalOptions="End"  Text="+" FontSize="Title" Padding="0" MaximumHeightRequest="50" WidthRequest="50" Command="{Binding AddTripCommand}" />

    </Grid>
</ContentPage>